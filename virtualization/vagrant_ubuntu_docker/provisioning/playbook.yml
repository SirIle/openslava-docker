---
- hosts: all
  sudo: yes
  tasks:
    - name: update apt cache if needed
      apt: update_cache=yes cache_valid_time=3600
    - name: make sure joe is installed
      apt: pkg=joe
    - name: make sure htop is installed
      apt: pkg=htop
    - name: make sure pip is installed
      apt: pkg=python-pip
    - name: configure tmux
      shell: creates=~vagrant/.tmux.conf echo new-session > ~vagrant/.tmux.conf
    - name: force colorful prompt
      shell: sed -i -e 's,#force_color_prompt,force_color_prompt,g' ~vagrant/.bashrc
    - name: add apt_key for docker
      apt_key: url=https://get.docker.io/gpg
    - name: add repository for docker
      apt_repository: repo='deb http://get.docker.io/ubuntu docker main'
    - name: make sure docker is installed
      apt: pkg=lxc-docker
    - name: add apt_key for nodejs
      apt_key: url=http://keyserver.ubuntu.com/pks/lookup?op=get&fingerprint=on&search=0xc7917b12
    - name: add repository for node
      apt_repository: repo='deb http://ppa.launchpad.net/chris-lea/node.js/ubuntu trusty main'
    - name: make sure nodejs is installed
      apt: pkg=nodejs
    - name: modify docker startup command
      shell: sed -i -e 's,#DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4",DOCKER_OPTS="-H tcp://10.10.10.30:4243 -H unix:///var/run/docker.sock",g' /etc/default/docker
    - name: restart docker service
      service: name=docker state=restarted
    - name: install docker-py
      pip: name='git+git://github.com/dotcloud/docker-py#egg=docker-py'
    - name: install maestro-ng
      pip: name='git+git://github.com/sirile/maestro-ng#egg=maestro'
