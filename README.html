<!DOCTYPE html><html><head><meta charset="utf-8"><style>body {
  width: 45em;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 30px;
}

@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #ffffff;
}

.markdown-body .highlight .c {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .k {
  font-weight: bold;
}

.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .cm {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .cp {
  color: #999999;
  font-weight: bold;
}

.markdown-body .highlight .c1 {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}

.markdown-body .highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}

.markdown-body .highlight .gd .x {
  color: #000000;
  background-color: #ffaaaa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999999;
}

.markdown-body .highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}

.markdown-body .highlight .gi .x {
  color: #000000;
  background-color: #aaffaa;
}

.markdown-body .highlight .go {
  color: #888888;
}

.markdown-body .highlight .gp {
  color: #555555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .kc {
  font-weight: bold;
}

.markdown-body .highlight .kd {
  font-weight: bold;
}

.markdown-body .highlight .kn {
  font-weight: bold;
}

.markdown-body .highlight .kp {
  font-weight: bold;
}

.markdown-body .highlight .kr {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #445588;
  font-weight: bold;
}

.markdown-body .highlight .m {
  color: #009999;
}

.markdown-body .highlight .s {
  color: #dd1144;
}

.markdown-body .highlight .n {
  color: #333333;
}

.markdown-body .highlight .na {
  color: teal;
}

.markdown-body .highlight .nb {
  color: #0086b3;
}

.markdown-body .highlight .nc {
  color: #445588;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: teal;
}

.markdown-body .highlight .ni {
  color: purple;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555555;
}

.markdown-body .highlight .nt {
  color: navy;
}

.markdown-body .highlight .nv {
  color: teal;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbbbbb;
}

.markdown-body .highlight .mf {
  color: #009999;
}

.markdown-body .highlight .mh {
  color: #009999;
}

.markdown-body .highlight .mi {
  color: #009999;
}

.markdown-body .highlight .mo {
  color: #009999;
}

.markdown-body .highlight .sb {
  color: #dd1144;
}

.markdown-body .highlight .sc {
  color: #dd1144;
}

.markdown-body .highlight .sd {
  color: #dd1144;
}

.markdown-body .highlight .s2 {
  color: #dd1144;
}

.markdown-body .highlight .se {
  color: #dd1144;
}

.markdown-body .highlight .sh {
  color: #dd1144;
}

.markdown-body .highlight .si {
  color: #dd1144;
}

.markdown-body .highlight .sx {
  color: #dd1144;
}

.markdown-body .highlight .sr {
  color: #009926;
}

.markdown-body .highlight .s1 {
  color: #dd1144;
}

.markdown-body .highlight .ss {
  color: #990073;
}

.markdown-body .highlight .bp {
  color: #999999;
}

.markdown-body .highlight .vc {
  color: teal;
}

.markdown-body .highlight .vg {
  color: teal;
}

.markdown-body .highlight .vi {
  color: teal;
}

.markdown-body .highlight .il {
  color: #009999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}
</style><title>README</title></head><body><article class="markdown-body"><h1>
<a name="user-content-running-the-cassandra-cluster-example" class="anchor" href="#running-the-cassandra-cluster-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the Cassandra cluster example</h1>

<h2>
<a name="user-content-checking-out-the-project-and-contents" class="anchor" href="#checking-out-the-project-and-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Checking out the project and contents</h2>

<p>You can check out the project from InnerSource with</p>

<div class="highlight highlight-bash"><pre>git clone git@innersource.accenture.com:eti-nordic-playground/eti-nordic-playground.git
</pre></div>

<p>This README document assumes that <em>eti-nordic-playground</em> directory is the root.</p>

<p>Under it are four relevant directories for setting up and running the container demo:</p>

<ul>
<li>dockerfiles (contains the script and container descriptors)</li>
<li>maestro (MaestroNG orchestration files)</li>
<li>vagrant (contains the Vagrant configuration files)</li>
<li>weave (contains the shell scripts for running containers and weave)</li>
</ul>

<h2>
<a name="user-content-prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prerequisites</h2>

<p>The environment has been tested in Windows 7 and Mac OS X. It should also run in Linux.</p>

<p>Following software has to be installed on the host (tested version numbers in parenthesis):</p>

<ul>
<li>VirtualBox (4.3.16)</li>
<li>Vagrant (1.6.5)</li>
</ul>

<p>On OS X and Linux you also need</p>

<ul>
<li>Ansible (1.7.2)</li>
</ul>

<p>The Vagrant scripts also assume that you have a directory called <em>~/Projects</em> created. It can be empty. On Windows, it should be <em>c:\users&lt;username&gt;\Projects</em> and in other operating systems under your home directory.</p>

<h2>
<a name="user-content-running-in-one-node-with-maestrong-orchestration" class="anchor" href="#running-in-one-node-with-maestrong-orchestration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running in one node with MaestroNG orchestration</h2>

<h3>
<a name="user-content-setting-up-the-environment" class="anchor" href="#setting-up-the-environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up the environment</h3>

<p>Start and enter node1</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd </span>vagrant/ubuntu_docker
vagrant up
vagrant ssh
</pre></div>

<p>You can also connect to the running node1 with other terminals. It has the host only network IP of 10.10.10.30. You need to use the Vagrant ssh key for the connection. Instructions for doing this for PuTTY can be found from <a href="https://blog.accenture.com/ilkka_anttonen/2014/04/15/connecting-to-vagrant-vm-on-windows-using-putty/">https://blog.accenture.com/ilkka_anttonen/2014/04/15/connecting-to-vagrant-vm-on-windows-using-putty/</a>.</p>

<p>This launches the node1 virtual machine and provisions it using Ansible. You can use <code>tmux</code> for multiple sessions.</p>

<h3>
<a name="user-content-building-the-images" class="anchor" href="#building-the-images" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building the images</h3>

<p>Build the container images</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ~/dockerfiles
./buildContainers.sh
</pre></div>

<h3>
<a name="user-content-running-the-containers" class="anchor" href="#running-the-containers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the containers</h3>

<p>Use MaestroNG to start the containers</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ~/maestro
maestro -f cassandra.yaml start
</pre></div>

<h2>
<a name="user-content-running-in-two-nodes-with-weave-and-registry" class="anchor" href="#running-in-two-nodes-with-weave-and-registry" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running in two nodes with Weave and registry</h2>

<h3>
<a name="user-content-setting-up-the-environment-1" class="anchor" href="#setting-up-the-environment-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up the environment</h3>

<p>Start node1</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd </span>vagrant/ubuntu_docker
vagrant up
</pre></div>

<p>Start node2</p>

<div class="highlight highlight-bash"><pre>vagrant up node2
</pre></div>

<p>Start docker registry</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ../ubuntu_docker_registry
vagrant up
</pre></div>

<h3>
<a name="user-content-building-and-pushing-the-images" class="anchor" href="#building-and-pushing-the-images" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building and pushing the images</h3>

<p>On node1 build the images and push core and cassandra to the local registry</p>

<pre><code>cd dockerimages
./buildContainers.sh
./pushContainers.sh
</code></pre>

<h3>
<a name="user-content-running-containers-in-node1" class="anchor" href="#running-containers-in-node1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running containers in node1</h3>

<p>On node1 use the shell script to start containers</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ~/weave
./startNode1.sh
</pre></div>

<h3>
<a name="user-content-running-containers-in-node2" class="anchor" href="#running-containers-in-node2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running containers in node2</h3>

<p>On node2 use the shell script to start containers. This will pull them from the local registry first.</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd</span> ~/weave
./startNode2.sh
</pre></div>

<h3>
<a name="user-content-connecting-the-nodes" class="anchor" href="#connecting-the-nodes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connecting the nodes</h3>

<p>On either of the nodes, connect to the <em>core</em> instance and join the Consul master nodes. For example on node2</p>

<div class="highlight highlight-bash"><pre>ssh root@localhost -p <span class="m">1000</span> <span class="s1">'consul join -wan 10.0.1.1'</span>
</pre></div>

<p>Restart Cassandra instance on that node so that it reconnects to the other datacenter</p>

<div class="highlight highlight-bash"><pre>ssh root@localhost -p <span class="m">1021</span> <span class="s1">'supervisorctl restart cassandra'</span>
</pre></div>

<p>After a while the nodes have joined to the same ring. This can be checked with</p>

<div class="highlight highlight-bash"><pre>ssh root@localhost -p <span class="m">1021</span> <span class="s1">'nodetool status'</span>
</pre></div>

<p>If you want to run cqlsh on one of the Cassandra containers, it can be done with</p>

<div class="highlight highlight-bash"><pre>ssh root@localhost -p <span class="m">1021</span> -t cqlsh
</pre></div>

<h3>
<a name="user-content-cleanup" class="anchor" href="#cleanup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cleanup</h3>

<p>To stop the running containers and clear out the instances use</p>

<div class="highlight highlight-bash"><pre>~/weave/stopNode.sh
</pre></div>

<h2>
<a name="user-content-checking-that-everything-is-working" class="anchor" href="#checking-that-everything-is-working" aria-hidden="true"><span class="octicon octicon-link"></span></a>Checking that everything is working</h2>

<p>Different services can be reached with a browser from the host. Services can be found from:</p>

<table>
<thead>
<tr>
<th>Service</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>Logstash on node1</td>
<td><a href="http://10.10.10.30">http://10.10.10.30</a></td>
</tr>
<tr>
<td>Logstash on node2</td>
<td><a href="http://10.10.10.40">http://10.10.10.40</a></td>
</tr>
<tr>
<td>ConsulUI</td>
<td><a href="http://10.10.10.30:8500/ui/dist">http://10.10.10.30:8500/ui/dist</a></td>
</tr>
<tr>
<td>Opscenter</td>
<td><a href="http://10.10.10.30:8888">http://10.10.10.30:8888</a></td>
</tr>
</tbody>
</table>

<p>Inside the Docker node the different containers can be accessed using ssh (username/password is root/root):</p>

<table>
<thead>
<tr>
<th>Container</th>
<th>Ssh port</th>
<th>Weave IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Core</td>
<td>1000</td>
<td>10.0.1.1</td>
</tr>
<tr>
<td>Cassandra1</td>
<td>1021</td>
<td>10.0.1.2</td>
</tr>
<tr>
<td>Cassandra2</td>
<td>1022</td>
<td>10.0.1.3</td>
</tr>
<tr>
<td>Cassandra3</td>
<td>1023</td>
<td>10.0.1.4</td>
</tr>
<tr>
<td>Opscenter</td>
<td>1121</td>
<td>10.0.1.10</td>
</tr>
<tr>
<td>Node</td>
<td>1001</td>
<td>10.0.1.20</td>
</tr>
<tr>
<td>Core (node2)</td>
<td>1000</td>
<td>10.0.2.1</td>
</tr>
<tr>
<td>Cassadra4 (node2)</td>
<td>1021</td>
<td>10.0.2.2</td>
</tr>
<tr>
<td>Cassandra5 (node2)</td>
<td>1022</td>
<td>10.0.2.3</td>
</tr>
</tbody>
</table>

<p>The command to connect to for example Cassandra1 on node1 is:</p>

<div class="highlight highlight-bash"><pre>ssh root@localhost -p 1021
</pre></div>

<h3>
<a name="user-content-creating-a-keyspace-and-few-test-rows" class="anchor" href="#creating-a-keyspace-and-few-test-rows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a keyspace and few test rows</h3>

<p>Ssh into one of the Cassandra containers and start up cqlsh</p>

<div class="highlight highlight-bash"><pre>ssh root@localhost -p <span class="m">1021</span> -t cqlsh
</pre></div>

<p>Enter the following (you can exit cqlsh with either exit or ctrl+d)</p>

<div class="highlight highlight-sql"><pre><span class="k">CREATE</span> <span class="n">KEYSPACE</span> <span class="n">demo</span> <span class="k">WITH</span> <span class="n">REPLICATION</span> <span class="o">=</span> <span class="err">{</span> <span class="s1">'class'</span> <span class="p">:</span> <span class="s1">'SimpleStrategy'</span><span class="p">,</span> <span class="s1">'replication_factor'</span> <span class="p">:</span> <span class="mi">2</span> <span class="err">}</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">demo</span><span class="p">.</span><span class="n">users</span> <span class="p">(</span> 
    <span class="n">userid</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">firstname</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">lastname</span> <span class="nb">text</span><span class="p">,</span> 
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">userid</span><span class="p">)</span> 
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">demo</span><span class="p">.</span><span class="n">users</span> <span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'ile'</span><span class="p">,</span><span class="s1">'Ilkka'</span><span class="p">,</span><span class="s1">'Anttonen'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">demo</span><span class="p">.</span><span class="n">users</span> <span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'toinen'</span><span class="p">,</span><span class="s1">'Some'</span><span class="p">,</span><span class="s1">'User'</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">demo</span><span class="p">.</span><span class="n">users</span> <span class="k">where</span> <span class="n">userid</span> <span class="o">=</span> <span class="s1">'ile'</span><span class="p">;</span>
</pre></div>

<p>Status of the Cassandra ring can be displayed with <code>nodetool status</code>.</p>

<h3>
<a name="user-content-using-icedcoffeescript-to-query-the-cluster" class="anchor" href="#using-icedcoffeescript-to-query-the-cluster" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using icedcoffeescript to query the cluster</h3>

<p>Connect to the node container</p>

<div class="highlight highlight-bash"><pre>ssh root@localhost -p 1001
</pre></div>

<p>Install the <em>node-cassandra-cql</em> module with npm</p>

<div class="highlight highlight-bash"><pre>npm install node-cassandra-cql
</pre></div>

<p>Create the following program, use your favourite editor and name the file cql.iced</p>

<div class="highlight highlight-coffeescript"><pre><span class="nv">cql = </span><span class="nx">require</span> <span class="s">'node-cassandra-cql'</span>
<span class="nv">client = </span><span class="k">new</span> <span class="nx">cql</span><span class="p">.</span><span class="nx">Client</span><span class="p">({</span><span class="nx">hosts</span><span class="o">:</span><span class="p">[</span><span class="s">'cassandra.service.consul'</span><span class="p">],</span><span class="nv">keyspace: </span><span class="s">'demo'</span><span class="p">})</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">execute</span> <span class="s">'SELECT * FROM demo.users where userid = ?'</span><span class="p">,</span> <span class="p">[</span><span class="s">'ile'</span><span class="p">],</span> <span class="nf">(err, result) -&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">'Result: '</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">firstname</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span> <span class="mi">0</span>
</pre></div>

<p>Now this program can be run</p>

<div class="highlight highlight-bash"><pre>iced cql.iced
</pre></div>

<p>You should get the result if you have previously created the test data as described in previous step.</p>

<h1>
<a name="user-content-cleanup-scripts" class="anchor" href="#cleanup-scripts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cleanup scripts</h1>

<p>To stop the containers and clean out unused images and remove instances use</p>

<div class="highlight highlight-bash"><pre>/vagrant/scripts/cleanDocker.sh
</pre></div>
</article></body></html>